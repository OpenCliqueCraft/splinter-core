<style>
    body,
    html {
        margin: 0px;
    }
</style>

<canvas id="canvas"></canvas>

<script>
    const SCALE = 20;

    var grid = {};

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var server = new WebSocket("ws://localhost:1000");

    server.onmessage = (msg) => {
        var split = msg.data.split(",");
        var x = parseInt(split[0]);
        var z = parseInt(split[1]);
        var t = parseInt(split[2]);

        if (grid[`${x}:${z}`] == null) grid[`${x}:${z}`] = [parseInt(t)];
        else grid[`${x}:${z}`].push(parseInt(t));
    };

    var last_resize = 0;
    function update_window_size() {
        canvas.width = document.body.clientWidth;
        canvas.height = document.body.clientHeight;
        last_resize = Date.now();
    }

    function random_color() {
        return "#" + Math.floor(Math.random() * 16777215).toString(16);
    }

    window.onresize = update_window_size;
    update_window_size();

    function drawRect(x, y, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, SCALE, SCALE);
    }

    function drawDot(x, y, color) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x + SCALE / 2, y + SCALE / 2, SCALE / 4, 0, 2 * Math.PI);
        ctx.fill();
    }

    function draw(x, y, val) {
        if (val.indexOf(1) != -1) drawRect(x, y, "red");
        if (val.indexOf(3) != -1) drawDot(x, y, "yellow");
    }

    setInterval(() => {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        var total_width = canvas.width / SCALE;
        var total_height = canvas.height / SCALE;

        var top_left_x = Math.ceil(total_width / -2);
        var top_left_y = Math.ceil(total_height / -2);

        for (var x = top_left_x; x < total_width; x++) {
            for (var y = top_left_y; y < total_height; y++) {
                var grid_val = grid[`${x}:${y}`];

                var val = Math.abs(x % 2) + Math.abs(y % 2);
                if (val == 0 || val == 2) ctx.fillStyle = "black";
                else ctx.fillStyle = "#1a1a1a";

                var sx = (x - top_left_x) * SCALE;
                var sy = (y - top_left_y) * SCALE;
                ctx.fillRect(sx, sy, SCALE, SCALE);

                if (grid_val != null) draw(sx, sy, grid_val);
            }
        }
    }, 60);
</script>
